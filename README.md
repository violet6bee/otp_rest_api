# Приложение защиты OTP-кодом от Promo IT#
## О проекте ##
Мы планируем разработать простое и удобное backend-приложение, которое поможет защитить операции с помощью временных кодов. Основная цель сервиса — обеспечить безопасность при выполнении различных действий, требующих подтверждения.

Что будет делать сервис?

Создавать операции на защиту — пользователи смогут инициировать защиту своих операций, чтобы добавить дополнительный уровень безопасности.

Генерировать защитный код — для каждой операции будет автоматически создаваться уникальный код, который будет использоваться для подтверждения.

Отправлять код — пользователи смогут получать защитные коды через разные каналы:

* SMS — вам предстоит использовать эмулятор для отправки SMS, чтобы протестировать функционал.
* Email — коды можно будет отправлять как на эмулятор, так и на реальные почтовые адреса.
* Telegram — с помощью Telegram API вы создадите бота, который будет отправлять коды пользователям. Проверять код — при выполнении операции пользователи смогут вводить полученный код, который будет проверяться на правильность.
* Настраивать время жизни и длину кода — каждый код будет иметь ограниченное время действия. Администратор сможет настраивать, как долго код будет действовать и сколько цифр он будет содержать.

Настраивать время жизни и длину кода — каждый код будет иметь ограниченное время действия. Администратор сможет настраивать, как долго код будет действовать и сколько цифр он будет содержать.

Вдохновение для проекта можно взять из концепции TOTP (Time-based One-Time Password), что поможет сделать защиту более надежной.

 <details>
   <summary> Что нужно сделать </summary>

 ## Требования к базе данных и работе с ней ##
База данных должна быть реализована с помощью PostgreSQL 17, взаимодействие с базой данных должен быть реализован через JDBC.

Должно быть реализовано минимум 3 таблицы:

* Пользователи (хранит логин пользователя, его пароль в зашифрованном виде, а также его роль).
* Конфигурация OTP-кода (количество записей в ней никогда не должно превышать 1).
* Таблица OTP-кодов (может содержать идентификатор операции в привязке к OTP-коду, но также допускается вынести логику работы с операциями в отдельную таблицу).

  OTP-код должен иметь минимум три статуса:

* ACTIVE (код активен);
* EXPIRED (код просрочен);
* USED (код прошел валидацию и был использован).

  ## Требования к API ##

  Для регистрации и аутентификации пользователей необходимо реализовать соответствующее API, которое должно минимально выполнять следующие операции:

* Регистрация нового пользователя.
У пользователей может быть две роли: либо администратор, либо простой пользователь. Если администратор уже существует, то регистрация второго администратора должна быть невозможной.
* Логин зарегистрированного пользователя.
Данная операция должна возвращать токен с ограниченным сроком действия для осуществления аутентификации и авторизации пользователя.
Простой пример работы с токенами можно найти здесь.

У администратора должна быть свое отдельное API, которое позволяет как минимум:

* Менять конфигурацию OTP-кодов (время жизни и количество знаков в коде).
* Получать список всех пользователей кроме администраторов.
* Удалять пользователей и привязанные к ним OTP-коды.
API пользователя минимально должно реализовывать следующие функции:

* Генерация OTP-кода привязанного к операции либо к ее идентификатору и рассылка его тремя способами либо сохранение сгенерированного кода в файл в корне проекта
* Валидация OTP-кода, который был выслан пользователю по одному из каналов
Пользователи, не являющиеся администраторами, не должны иметь доступа к API администратора.

 ## Требования к каналам рассылки сгенерированных кодов  ## 
Пользователи смогут получать защитные коды через различные каналы, что обеспечит гибкость и удобство в использовании сервиса. Для реализации этой функциональности необходимо учесть следующие требования:

* Отправка кода по SMS — вам предстоит использовать эмулятор для отправки SMS, чтобы протестировать функционал. Это позволит имитировать процесс получения кодов без необходимости использования реальных SMS.
* Отправка кода по Email — коды можно будет отправлять как на эмулятор, так и на реальные почтовые адреса. Это обеспечит пользователям возможность получать коды на удобный для них почтовый ящик.
* Отправка кода через Telegram — с помощью Telegram API вы создадите бота, который будет отправлять коды пользователям. Это позволит мгновенно доставлять коды через популярное приложение для обмена сообщениями.
* Сохранение кода в файл — реализуйте возможность сохранения сгенерированных кодов в файл.


## Требования к структуре приложения ## 
Приложение должно иметь три основных слоя:

* Слой API, содержащий обработчики HTTP-запросов.
* Слой API (хэндлеров или контроллеров) должен быть выполнен с помощью пакета com.sun.net.httpserver, встроенного в Java начиная с версии SE 6. Также допускается использование Spring MVC.
* Слой сервисов, содержащий в себе основную бизнес-логику приложения.
* Слой DAO, содержащий в себе классы, осуществляющие выполнение запросов к БД.
  
## Остальные требования к функционалу ## 
* Необходимо реализовать механизм, который будет отмечать просроченные OTP-коды раз в определенный интервал времени и присваивать им статус EXPIRED.
* Необходимо настроить логирование в приложении с помощью любой понравившейся вам библиотеки из модуля про логирование.
* Приложение должно использовать систему сборки Gradle или Maven.
</details> 

## Технологии ##
* Java Spring Boot
* PostgreSql
* Docker/Docker Compose

## Методы Rest API ##

* /auth/sign-up - регистрация
* /auth/sign-in - получение токена
* /otp/create - создание otp кода
* /otp/check - проверка (валидация) otp кода
* /otp/download - скачать все коды в файл.
* /otp/settings - установка настроек (только админ)
* /all_users - список всех пользователей (только админ)
* /users/{id} - удаление пользователя (только админ)
